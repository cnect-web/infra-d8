INSTANCE_ID=${1:-bastion}
USER="ec2-user"
STACK_NAME="ConnectWebTeam"
# Get the bastion IP.
BASTION=$(aws ec2 describe-instances --filters "Name=tag:aws:cloudformation:logical-id,Values=BastionAutoScalingGroup" "Name=instance-state-name,Values=running" --query "Reservations[*].Instances[*].PublicIpAddress" --output text)

if [ "$INSTANCE_ID" == "bastion" ]; then
  ssh -i connect_web_team_prod.pem ${USER}@${BASTION}
else
  # Get the web instance IPs.
  INSTANCE=$(aws ec2 describe-instances --filters "Name=tag:aws:cloudformation:logical-id,Values=WebAutoScalingGroup" "Name=instance-state-name,Values=running" --query "Reservations[*].Instances[*].PrivateIpAddress | [$INSTANCE_ID]" --output text)
  echo "Connecting to $INSTANCE"
  ssh-add connect_web_team_prod.pem
  ssh -A -i connect_web_team_prod.pem -t ${USER}@${BASTION} ssh ${USER}@${INSTANCE}
fi
