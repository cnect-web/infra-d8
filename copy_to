INSTANCE_ID=${2:-bastion}
USER="ec2-user"
STACK_NAME="ConnectWebTeam"
# Get the bastion IP.
BASTION=$(aws ec2 describe-instances --filters "Name=tag:aws:cloudformation:logical-id,Values=BastionAutoScalingGroup" "Name=instance-state-name,Values=running" --query "Reservations[*].Instances[*].PublicIpAddress" --output text)

# Get the web instance IPs.
INSTANCE=$(aws ec2 describe-instances --filters "Name=tag:aws:cloudformation:logical-id,Values=WebAutoScalingGroup" "Name=instance-state-name,Values=running" --query "Reservations[*].Instances[*].PrivateIpAddress | [$INSTANCE_ID]" --output text)
echo "Connecting to $INSTANCE"

# Copy through the bastion.
scp -i connect_web_team_prod.pem -o ProxyCommand="ssh -i connect_web_team_prod.pem -W %h:%p ec2-user@${BASTION}" $1 ec2-user@${INSTANCE}:~
